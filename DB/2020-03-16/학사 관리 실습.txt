-- 테이블 순서는 관계를 고려하여 한 번에 실행해도 에러가 발생하지 않게 정렬되었습니다.

-- SUBJECT Table Create SQL
CREATE TABLE SUBJECT
(
    SUBJECT_NO       NUMBER           NOT NULL, 
    SUBJECT_TITLE    VARCHAR2(100)    NOT NULL, 
    CREDIT           NUMBERR          NOT NULL, 
    CONSTRAINT SUBJECT_PK PRIMARY KEY (SUBJECT_NO)
)
/

CREATE SEQUENCE SUBJECT_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER SUBJECT_AI_TRG
BEFORE INSERT ON SUBJECT 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT SUBJECT_SEQ.NEXTVAL
    INTO :NEW.SUBJECT_NO
    FROM DUAL;
END;
/

--DROP TRIGGER SUBJECT_AI_TRG;
/

--DROP SEQUENCE SUBJECT_SEQ;
/

COMMENT ON TABLE SUBJECT IS '과목'
/

COMMENT ON COLUMN SUBJECT.SUBJECT_NO IS '과목코드'
/

COMMENT ON COLUMN SUBJECT.SUBJECT_TITLE IS '과목명'
/

COMMENT ON COLUMN SUBJECT.CREDIT IS '학점'
/


-- SUBJECT Table Create SQL
CREATE TABLE USER
(
    USER_ID      VARCHAR2(20)     NOT NULL, 
    USER_NAME    VARCHAR2(30)     NOT NULL, 
    PHONE        CHAR(13)         NULL, 
    USER_ADDR    VARCHAR2(500)    NULL, 
    STU_PRO      CHAR(3)          NOT NULL, 
    CONSTRAINT USER_PK PRIMARY KEY (USER_ID)
)
/

COMMENT ON TABLE USER IS '회원'
/

COMMENT ON COLUMN USER.USER_ID IS 'ID'
/

COMMENT ON COLUMN USER.USER_NAME IS '이름'
/

COMMENT ON COLUMN USER.PHONE IS '전화번호'
/

COMMENT ON COLUMN USER.USER_ADDR IS '주소'
/

COMMENT ON COLUMN USER.STU_PRO IS '학생/교수 여부'
/


-- SUBJECT Table Create SQL
CREATE TABLE CLASS
(
    CLASS_NO          NUMBER          NOT NULL, 
    SUBJECT_NO        NUMBER          NOT NULL, 
    USER_ID           VARCHAR2(20)    NOT NULL, 
    CLASS_ALL_TILE    NUMBER          NOT NULL, 
    CLASS_DAY         VARCHAR2(3)     NOT NULL, 
    CLASS_PERIOD      NUMBER          NOT NULL, 
    CLASS_TITLE       NUMBER          NOT NULL, 
    CONSTRAINT CLASS_PK PRIMARY KEY (CLASS_NO, SUBJECT_NO, USER_ID)
)
/

CREATE SEQUENCE CLASS_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER CLASS_AI_TRG
BEFORE INSERT ON CLASS 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT CLASS_SEQ.NEXTVAL
    INTO :NEW.CLASS_NO
    FROM DUAL;
END;
/

--DROP TRIGGER CLASS_AI_TRG;
/

--DROP SEQUENCE CLASS_SEQ;
/

COMMENT ON TABLE CLASS IS '강좌'
/

COMMENT ON COLUMN CLASS.CLASS_NO IS '강좌ID'
/

COMMENT ON COLUMN CLASS.SUBJECT_NO IS '과목코드'
/

COMMENT ON COLUMN CLASS.USER_ID IS '교수ID'
/

COMMENT ON COLUMN CLASS.CLASS_ALL_TILE IS '총 강의시간'
/

COMMENT ON COLUMN CLASS.CLASS_DAY IS '강의 요일'
/

COMMENT ON COLUMN CLASS.CLASS_PERIOD IS '강의 교시'
/

COMMENT ON COLUMN CLASS.CLASS_TITLE IS '강의 시간'
/

ALTER TABLE CLASS
    ADD CONSTRAINT FK_CLASS_SUBJECT_NO_SUBJECT_SU FOREIGN KEY (SUBJECT_NO)
        REFERENCES SUBJECT (SUBJECT_NO)
/

ALTER TABLE CLASS
    ADD CONSTRAINT FK_CLASS_USER_ID_USER_USER_ID FOREIGN KEY (USER_ID)
        REFERENCES USER (USER_ID)
/


-- SUBJECT Table Create SQL
CREATE TABLE ORDER_CLASS
(
    CLASS_NO         NUMBER          NOT NULL, 
    USER_ID          VARCHAR2(20)    NOT NULL, 
    ATTEND_SCORE     NUMBER          NULL, 
    MIDTERM_SCORE    NUMBER          NULL, 
    FINAL_SCORE      NUMBER          NULL, 
    TASK_SCORE       NUMBER          NULL, 
    CONSTRAINT ORDER_CLASS_PK PRIMARY KEY (CLASS_NO, USER_ID)
)
/

COMMENT ON TABLE ORDER_CLASS IS '수강신청'
/

COMMENT ON COLUMN ORDER_CLASS.CLASS_NO IS '강좌ID'
/

COMMENT ON COLUMN ORDER_CLASS.USER_ID IS '학생ID'
/

COMMENT ON COLUMN ORDER_CLASS.ATTEND_SCORE IS '출석점수'
/

COMMENT ON COLUMN ORDER_CLASS.MIDTERM_SCORE IS '중간고사'
/

COMMENT ON COLUMN ORDER_CLASS.FINAL_SCORE IS '기말고사'
/

COMMENT ON COLUMN ORDER_CLASS.TASK_SCORE IS '과제점수'
/

ALTER TABLE ORDER_CLASS
    ADD CONSTRAINT FK_ORDER_CLASS_USER_ID_USER_US FOREIGN KEY (USER_ID)
        REFERENCES USER (USER_ID)
/

ALTER TABLE ORDER_CLASS
    ADD CONSTRAINT FK_ORDER_CLASS_CLASS_NO_SUBJEC FOREIGN KEY (CLASS_NO)
        REFERENCES SUBJECT (SUBJECT_NO)
/


-- SUBJECT Table Create SQL
CREATE TABLE EVAL_STAND
(
    CLASS_NO         NUMBER    NOT NULL, 
    ATTEND_STAND     NUMBER    NULL, 
    MIDTERM_SCORE    NUMBER    NULL, 
    FINAL_SCORE      NUMBER    NULL, 
    TASK_SCORE       NUMBER    NULL, 
    CONSTRAINT EVAL_STAND_PK PRIMARY KEY (CLASS_NO)
)
/

COMMENT ON TABLE EVAL_STAND IS '평가기준'
/

COMMENT ON COLUMN EVAL_STAND.CLASS_NO IS '강좌ID'
/

COMMENT ON COLUMN EVAL_STAND.ATTEND_STAND IS '출석점수'
/

COMMENT ON COLUMN EVAL_STAND.MIDTERM_SCORE IS '중간고사'
/

COMMENT ON COLUMN EVAL_STAND.FINAL_SCORE IS '기말고사'
/

COMMENT ON COLUMN EVAL_STAND.TASK_SCORE IS '과제점수'
/

ALTER TABLE EVAL_STAND
    ADD CONSTRAINT FK_EVAL_STAND_CLASS_NO_SUBJECT FOREIGN KEY (CLASS_NO)
        REFERENCES SUBJECT (SUBJECT_NO)
/


