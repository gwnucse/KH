-- 테이블 순서는 관계를 고려하여 한 번에 실행해도 에러가 발생하지 않게 정렬되었습니다.

-- PRODUCT Table Create SQL
CREATE TABLE PRODUCT
(
    PRO_NO      NUMBER          NOT NULL, 
    PRO_NAME    VARCHAR2(20)    NOT NULL, 
    CONSTRAINT PRODUCT_PK PRIMARY KEY (PRO_NO)
)
/

CREATE SEQUENCE PRODUCT_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER PRODUCT_AI_TRG
BEFORE INSERT ON PRODUCT 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT PRODUCT_SEQ.NEXTVAL
    INTO :NEW.PRO_NO
    FROM DUAL;
END;
/

--DROP TRIGGER PRODUCT_AI_TRG;
/

--DROP SEQUENCE PRODUCT_SEQ;
/

COMMENT ON TABLE PRODUCT IS '상품 테이블'
/

COMMENT ON COLUMN PRODUCT.PRO_NO IS '상품코드'
/

COMMENT ON COLUMN PRODUCT.PRO_NAME IS '상품명'
/


-- PRODUCT Table Create SQL
CREATE TABLE CLIENT
(
    CLI_NO      NUMBER          NOT NULL, 
    CLI_NAME    VARCHAR2(30)    NOT NULL, 
    PHONE       CHAR(13)        NULL, 
    CONSTRAINT CLIENT_PK PRIMARY KEY (CLI_NO)
)
/

CREATE SEQUENCE CLIENT_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER CLIENT_AI_TRG
BEFORE INSERT ON CLIENT 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT CLIENT_SEQ.NEXTVAL
    INTO :NEW.CLI_NO
    FROM DUAL;
END;
/

--DROP TRIGGER CLIENT_AI_TRG;
/

--DROP SEQUENCE CLIENT_SEQ;
/

COMMENT ON TABLE CLIENT IS '고객'
/

COMMENT ON COLUMN CLIENT.CLI_NO IS '고객번호'
/

COMMENT ON COLUMN CLIENT.CLI_NAME IS '고객명'
/

COMMENT ON COLUMN CLIENT.PHONE IS '고객번호'
/


-- PRODUCT Table Create SQL
CREATE TABLE PRO_JOIN
(
    JOIN_NO          NUMBER    NOT NULL, 
    PRO_NO           NUMBER    NOT NULL, 
    CONTRACT_DATE    DATE      NOT NULL, 
    CLI_NO           NUMBER    NOT NULL, 
    START_DATE       DATE      NOT NULL, 
    END_DATE         DATE      NOT NULL, 
    PREMIUM          NUMBER    NOT NULL, 
    TURNING          NUMBER    NOT NULL, 
    CONSTRAINT PRO_JOIN_PK PRIMARY KEY (JOIN_NO, PRO_NO, CLI_NO)
)
/

CREATE SEQUENCE PRO_JOIN_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER PRO_JOIN_AI_TRG
BEFORE INSERT ON PRO_JOIN 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT PRO_JOIN_SEQ.NEXTVAL
    INTO :NEW.JOIN_NO
    FROM DUAL;
END;
/

--DROP TRIGGER PRO_JOIN_AI_TRG;
/

--DROP SEQUENCE PRO_JOIN_SEQ;
/

COMMENT ON TABLE PRO_JOIN IS '상품가입'
/

COMMENT ON COLUMN PRO_JOIN.JOIN_NO IS '계약번호'
/

COMMENT ON COLUMN PRO_JOIN.PRO_NO IS '상품코드'
/

COMMENT ON COLUMN PRO_JOIN.CONTRACT_DATE IS '계약일자'
/

COMMENT ON COLUMN PRO_JOIN.CLI_NO IS '고객번호'
/

COMMENT ON COLUMN PRO_JOIN.START_DATE IS '보험시작일자'
/

COMMENT ON COLUMN PRO_JOIN.END_DATE IS '보험종료일자'
/

COMMENT ON COLUMN PRO_JOIN.PREMIUM IS '매월 납입보험료'
/

COMMENT ON COLUMN PRO_JOIN.TURNING IS '총 난입회차'
/

ALTER TABLE PRO_JOIN
    ADD CONSTRAINT FK_PRO_JOIN_CLI_NO_CLIENT_CLI_ FOREIGN KEY (CLI_NO)
        REFERENCES CLIENT (CLI_NO)
/

ALTER TABLE PRO_JOIN
    ADD CONSTRAINT FK_PRO_JOIN_PRO_NO_PRODUCT_PRO FOREIGN KEY (PRO_NO)
        REFERENCES PRODUCT (PRO_NO)
/


